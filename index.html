<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ewan's LLM</title>

  <link rel="stylesheet" href="css/theme.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <div class="app">
    <!-- LEFT: settings + input -->
    <div class="panel">
      <div class="panel-head">
        <div>
          <h2>Ewan's LLM</h2>
          <div class="muted">Enter to send | Shift+Enter newline | Streaming on</div>
        </div>
        <button id="openSettings" class="icon-btn" type="button" title="Settings">âš™</button>
      </div>

      <!-- Canonical base URL (hidden; still used by fetch code) -->
      <input id="base" value="http://192.168.1.129:1234" type="hidden" />

      <!-- Selected server (nickname only, no IP) -->
      <div class="row">
        <label for="serverSelect">Selected Server</label>
        <select id="serverSelect"></select>
      </div>

      <div class="muted slim-note" style="margin-top:-4px;">Models load automatically when you change servers.</div>

      <div class="row">
        <label for="model">Model</label>
        <select id="model"></select>
      </div>

      <div class="btnfull" style="margin-top: var(--space);">
        <button id="toggleSystemPrompt" type="button">Custom system instruction</button>
      </div>

      <div id="systemPromptRow" class="hidden">
        <label for="systemPrompt" style="display:block; margin-bottom:8px;">System prompt</label>
        <textarea id="systemPrompt" placeholder="Set behaviour, tone, or constraints..." style="height:120px;"></textarea>
      </div>

      <div class="btnfull">
        <button id="stop" type="button" disabled>Stop</button>
      </div>

      <label for="prompt" style="display:block; margin-bottom:8px;">Prompt</label>
      <textarea id="prompt" placeholder="Type a prompt..."></textarea>

      <div class="btnrow" style="margin-top: var(--space); margin-bottom: 0;">
        <button id="send" type="button">Send</button>
        <button id="clear" type="button">Clear</button>
      </div>

      <div class="btnrow" style="margin-top: var(--space);">
        <button id="retry" type="button">Retry last</button>
        <button id="clearHistory" type="button">Clear history</button>
      </div>

      <div id="statusBar" class="muted slim-note">(idle)</div>
    </div>

    <!-- RIGHT: output -->
    <div class="panel output-panel">
      <div class="output-shell">
        <div id="out">(nothing yet)</div>
        <div id="vizShell">
          <canvas id="viz"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div id="settingsModal" class="modal hidden">
    <div class="modal-content panel">
      <div class="modal-header">
        <h3>Settings</h3>
        <button id="closeSettings" type="button">Close</button>
      </div>

      <div class="settings-section">
        <div class="section-title">Servers</div>
        <div class="row">
          <label for="settingsServerSelect">Saved Servers</label>
          <select id="settingsServerSelect"></select>
        </div>
        <div class="action-row" style="margin-bottom: var(--space);">
          <button id="settingsServerRemove" type="button">Remove</button>
        </div>
        <div class="stack">
          <input id="settingsServerNick" placeholder="Nickname (e.g., bitfuser)" />
          <input id="settingsServerUrl" placeholder="http://192.168.1.129:1234" />
          <div class="action-row">
            <button id="settingsServerSave" type="button">Add / Update</button>
          </div>
          <div class="muted slim-note">Stored locally in your browser (localStorage).</div>
        </div>
      </div>

      <div class="settings-section">
        <div class="section-title">Generation</div>
        <div class="row">
          <label for="temp">Temp</label>
          <input id="temp" type="number" min="0" max="2" step="0.1" value="0.7" />
        </div>
        <div class="row">
          <label for="max">Max tokens</label>
          <input id="max" type="number" min="1" max="6000" step="1" value="3000" />
        </div>
      </div>

      <div class="settings-section">
        <div class="section-title">Screen FX</div>
        <div class="row range-row">
          <label for="glowRange">Glow</label>
          <input id="glowRange" type="range" min="0" max="2" step="0.05" value="1" />
        </div>
        <div class="row range-row">
          <label for="scanlineRange">Scanlines</label>
          <input id="scanlineRange" type="range" min="0" max="0.6" step="0.02" value="0.09" />
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
